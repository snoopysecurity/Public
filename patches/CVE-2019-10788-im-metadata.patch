From ea15dddbe0f65694bfde36b78dd488e90f246639 Mon Sep 17 00:00:00 2001
From: Sam Sanoop <sams@snyk.io>
Date: Mon, 3 Feb 2020 21:26:09 +0000
Subject: [PATCH] fix: check path argument before processing (#10)

hotfix to re mediate command injection
---
 index.js | 15 +++++++++------
 1 file changed, 9 insertions(+), 6 deletions(-)

diff --git a/index.js b/index.js
index d85f5ff..54b8ed6 100644
--- a/index.js
+++ b/index.js
@@ -9,15 +9,18 @@ module.exports = function(path, opts, cb) {
     opts = {};
   }
 
-  var cmd = module.exports.cmd(path, opts);
-  opts.timeout = opts.timeout || 5000;
-
-  exec(cmd, opts, function(e, stdout, stderr) {
-    if (e) { return cb(e); }
+  if(/;|&|`|\$|\(|\)|\|\||\||!|>|<|\?|\${/g.test(JSON.stringify(path))) {
+    console.log('Input Validation failed, Suspicious Characters found');
+  } else {
+    var cmd = module.exports.cmd(path, opts);
+    opts.timeout = opts.timeout || 5000;
+    exec(cmd, opts, function(e, stdout, stderr) {
+      if (e) { return cb(e); }
     if (stderr) { return cb(new Error(stderr)); }
 
-    return cb(null, module.exports.parse(path, stdout, opts));
+      return cb(null, module.exports.parse(path, stdout, opts));
   });
+}
 };
 
 module.exports.cmd = function(path, opts) {
